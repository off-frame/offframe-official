---
import OffFrameButton from "./OffFrameButton.astro";
---

<div class="sidenav-content">
  <div class="bottom">
    <a href="/about" class="about-link">About</a>
    <hr />

    <div class="offframe-area">
      <p class="offframe-copy">枠を外し、<br>写真の外側に<br>広がる世界へ。</p>
      <p class="offframe-title" id="drawerOffframeTitle">OFFフレームモード<br>を無料体験する</p>
      <OffFrameButton id="drawerOffframeBtn" />
      <button class="premium-btn" id="drawerPremiumBtn">Premium</button>
    </div>

    <hr />

    <div class="auth-area">
      <a href="/mypage" class="about-link mypage-link auth-mypage-btn" style="display:none;">MyPage</a>
      <button class="drawer-auth-status" id="drawerAuthStatus" style="display:none;" onclick="window.handleLogout?.()">
        <span class="auth-status-dot"></span>
        <span class="auth-status-text">ログイン中</span>
      </button>
      <button class="auth-login-btn auth-nav-btn" onclick="window.openAuthModal?.()">ログイン</button>
    </div>

    <hr />

    <div class="sns-section">
      <span class="section-label">公式SNS</span>
      <div class="sns-links">
        <a href="#" class="sns-btn">X</a>
        <a href="#" class="sns-btn">TikTok</a>
      </div>
    </div>

    <div class="share-section">
      <span class="section-label">シェア</span>
      <div class="share-links">
        <button class="share-icon-btn" id="drawerShareX" aria-label="Xでシェア">
          <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-4.714-6.231-5.401 6.231H2.744l7.73-8.835L1.254 2.25H8.08l4.253 5.622L18.244 2.25zm-1.161 17.52h1.833L7.084 4.126H5.117L17.083 19.77z"/>
          </svg>
        </button>
        <button class="share-icon-btn" id="drawerShareFb" aria-label="Facebookでシェア">
          <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
          </svg>
        </button>
      </div>
    </div>

    <hr />

    <div class="clock-wrap">
      <span class="clock-label">日本時間</span>
      <div class="clock" id="drawerClock">--:--:--</div>
    </div>

    <hr />
    <p class="copyright">© 2026 OFF FRAME</p>
  </div>
</div>

<style>
  .sidenav-content {
    padding: 1rem;
    display: flex;
    flex-direction: column;
    height: 100%;
  }

  .bottom {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-top: 2rem;
  }

  hr {
    border: none;
    border-top: 1px solid #333;
    margin: 0 -1rem;
  }

  .offframe-area {
    display: flex;
    flex-direction: column;
    gap: 0.7rem;
    margin-bottom: 1.5rem;
  }

  .offframe-copy {
    font-family: "Shippori Mincho", serif;
    font-size: 1rem;
    line-height: 1.9;
    letter-spacing: 0.2em;
    color: #fff;
    opacity: 0.85;
    margin: 1rem 0 0;
  }

  .offframe-title {
    font-family: "Shippori Mincho", serif;
    font-size: 0.8rem;
    line-height: 1.9;
    letter-spacing: 0.1em;
    color: #fff;
    opacity: 0.85;
    margin: 0 0 0.5rem;
  }

  .premium-btn {
    display: block;
    width: 100%;
    background: #dbc06c;
    color: #000;
    text-align: center;
    text-decoration: none;
    font-family: "Cormorant Garamond", serif;
    font-weight: 300;
    font-size: 0.85rem;
    letter-spacing: 0.2em;
    padding: 0.7rem 0.75rem;
    border: none;
    border-radius: 100px;
    box-sizing: border-box;
    transition: opacity 0.25s ease;
    margin-top: 0.5rem;
    cursor: pointer;
  }

  .premium-btn:hover { opacity: 0.75; }

  .premium-btn.active {
    background: #fff;
    color: #000;
    box-shadow: 0 0 12px rgba(255, 255, 255, 0.6), 0 0 24px rgba(255, 255, 255, 0.2);
  }


  .about-link {
    font-family: "Cormorant Garamond", serif;
    font-weight: 300;
    font-size: 1.2rem;
    letter-spacing: 0.2em;
    text-decoration: none;
    color: #fff;
    opacity: 0.8;
    margin-top: 1rem;
  }

  .about-link:hover { opacity: 1; }

  .auth-area .mypage-link {
    font-size: 1.3rem;
    margin-top: 0;
    margin-bottom: 0.4rem;
  }

  .sns-section, .share-section {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .section-label {
    font-family: "Cormorant Garamond", serif;
    font-size: 0.65rem;
    letter-spacing: 0.2em;
    color: #fff;
    opacity: 0.4;
  }

  .sns-links {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .sns-btn {
    font-family: "Cormorant Garamond", serif;
    font-weight: 100;
    font-size: 1.3rem;
    letter-spacing: 0.1em;
    text-decoration: none;
    color: #fff;
    opacity: 0.7;
  }

  .sns-btn:hover { opacity: 1; }

  .share-section { display: none; }

  .share-links {
    display: flex;
    flex-direction: row;
    gap: 1.3rem;
    align-items: center;
  }

  .share-icon-btn {
    background: transparent;
    border: none;
    color: #fff;
    opacity: 0.5;
    cursor: pointer;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: opacity 0.2s ease;
  }

  .share-icon-btn:hover { opacity: 1; }
  .share-icon-btn svg { width: 100%; height: 100%; }

  .clock-wrap {
    display: flex;
    flex-direction: column;
  }

  .clock-label {
    font-family: "Shippori Mincho", serif;
    font-size: 0.7rem;
    letter-spacing: 0.1em;
    color: #fff;
    opacity: 0.5;
  }

  .clock {
    font-family: "Cormorant Garamond", serif;
    font-weight: 300;
    font-size: 1.8rem;
    letter-spacing: 0.1em;
    color: #fff;
    opacity: 0.6;
  }

  .auth-area {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
  }

  .drawer-auth-status {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    background: transparent;
    border: none;
    padding: 0;
    cursor: pointer;
    transition: opacity 0.2s;
  }

  .drawer-auth-status:hover { opacity: 0.7; }

  .auth-status-dot {
    width: 5px;
    height: 5px;
    border-radius: 50%;
    background: #4ade80;
    flex-shrink: 0;
  }

  .auth-status-text {
    font-family: "Cormorant Garamond", serif;
    font-size: 0.7rem;
    letter-spacing: 0.15em;
    color: #fff;
    opacity: 0.6;
  }

  .auth-nav-btn {
    background: transparent;
    border: none;
    padding: 0.2rem 0;
    font-family: "Cormorant Garamond", serif;
    font-weight: 300;
    font-size: 0.75rem;
    letter-spacing: 0.2em;
    color: #fff;
    opacity: 0.5;
    cursor: pointer;
    text-align: left;
    transition: opacity 0.2s;
  }

  .auth-nav-btn:hover { opacity: 1; }

  .copyright {
    font-family: "Cormorant Garamond", serif;
    font-weight: 300;
    font-size: 0.7rem;
    letter-spacing: 0.1em;
    color: #fff;
    opacity: 0.4;
    margin: 0;
    padding-bottom: 3rem;
  }
</style>

<script is:inline>
  function initDrawer() {
    var offframeTitle = document.getElementById("drawerOffframeTitle");
    var isPremium = localStorage.getItem("offframe_premium") === "1";
    if (offframeTitle && isPremium) {
      offframeTitle.style.display = "none";
    }

    var premiumBtn = document.getElementById("drawerPremiumBtn");
    if (premiumBtn) {
      if (isPremium) {
        var isActive = localStorage.getItem("offframe") === "1";
        premiumBtn.classList.toggle("active", isActive);
      }
      premiumBtn.onclick = function() {
        var sbKey = Object.keys(localStorage).find(function(k) { return k.startsWith("sb-") && k.endsWith("-auth-token"); });
        var isLoggedIn = sbKey ? !!localStorage.getItem(sbKey) : false;
        if (!isLoggedIn) {
          window.openPromoOverlay?.();
          return;
        }
        if (localStorage.getItem("offframe_premium") === "1") {
          var next = localStorage.getItem("offframe") === "1" ? "0" : "1";
          localStorage.setItem("offframe", next);
          var active = next === "1";
          premiumBtn.classList.toggle("active", active);
          // モバイル記事下Premiumボタンも同期
          var mobilePrem = document.getElementById("mobilePremiumBtn");
          if (mobilePrem) mobilePrem.classList.toggle("active", active);
          // オーバーレイPremiumボタンも同期
          var overlayPrem = document.getElementById("overlayPremiumBtn");
          if (overlayPrem) overlayPrem.classList.toggle("active", active);
          document.querySelectorAll("img.switchable").forEach(function(img) {
            img.classList.add("blurring");
            setTimeout(function() {
              img.src = active ? img.dataset.full : img.dataset.general;
              setTimeout(function() { img.classList.remove("blurring"); }, 100);
            }, 300);
          });
        } else {
          window.openPremiumModal?.();
        }
      };
    }

    const clock = document.getElementById("drawerClock");
    if (clock) {
      setInterval(() => {
        clock.textContent = new Date().toLocaleTimeString("ja-JP", {
          timeZone: "Asia/Tokyo",
          hour12: false
        });
      }, 1000);
    }

    const shareX = document.getElementById("drawerShareX");
    if (shareX) {
      shareX.onclick = () => {
        const url = encodeURIComponent(location.href);
        const text = encodeURIComponent(document.title);
        window.open("https://twitter.com/intent/tweet?url=" + url + "&text=" + text, "_blank");
      };
    }

    const shareFb = document.getElementById("drawerShareFb");
    if (shareFb) {
      shareFb.onclick = () => {
        const url = encodeURIComponent(location.href);
        window.open("https://www.facebook.com/sharer/sharer.php?u=" + url, "_blank");
      };
    }
  }

  document.addEventListener("astro:page-load", initDrawer);
  initDrawer();
</script>